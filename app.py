from flask import Flask, request, abort
from linebot import LineBotApi, WebhookHandler
from linebot.exceptions import InvalidSignatureError
from linebot.models import *
import requests
from bs4 import BeautifulSoup
import pandas as pd
import pygsheets
import json

app = Flask(__name__)  

line_bot_api = LineBotApi('U5hlah8NxPTDI61P6+cqf+sVBTJixlenSE/ihCGVYVRf0kbVGUMP57qOBpxxzTIIeXdWvX5dnF6jXdOP/mASdmTKiV/XM5qbRVUHn0DvXckVqNVTBo/A+zT+v+NHTr7li4fjHgwFT8JgvFBDVYZjOAdB04t89/1O/w1cDnyilFU=')
handler = WebhookHandler('1b59f7e2aae7872e0ec20799920c474b')

gc = pygsheets.authorize(service_account_file='./gsheet.json')
sht = gc.open_by_url('https://docs.google.com/spreadsheets/d/1cxvkIggrRHYnZy0oUH-leCFHy3gWdJGEi7XC3i1Hv3c/edit#gid=0')

flex_message = {
  "type": "bubble",
  "hero": {
    "type": "image",
    "url": "data:image/jpeg;base64,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",
    "size": "full",
    "aspectRatio": "20:13",
    "aspectMode": "cover",
  },
  "body": {
    "type": "box",
    "layout": "vertical",
    "spacing": "md",
    "contents": [
      {
        "type": "text",
        "text": "",
        "size": "xl",
        "weight": "bold"
      }
    ]
  },
  "footer": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "button",
        "style": "primary",
        "color": "#905c44",
        "margin": "xxl",
        "action": {
          "type": "uri",
          "label": "前往網站",
          "uri": ""
        }
      }
    ]
  }
}

@app.route("/callback", methods=['OPTIONS', 'POST'])
def callback():
    if request.method == 'OPTIONS':
        response = make_response()
        response.headers.add('Access-Control-Allow-Origin', '*')
        response.headers.add('Access-Control-Allow-Headers', 'Content-Type')
        response.headers.add('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
        return response
    # get X-Line-Signature header value
    signature = request.headers['X-Line-Signature']
    # get request body as text
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)
    # handle webhook body
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'

@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    text = event.message.text
    if text == "本周重要公告":
        wks = sht[0]
        flex_message["body"]["contents"][0]["text"] = wks.get_value("A2")
        flex_message["footer"]["contents"][0]["action"]["uri"] = wks.get_value("B2")
        line_bot_api.reply_message(event.reply_token,FlexSendMessage(alt_text="本周重要公告", contents=flex_message))

@app.route("/")
def home():
    return 'Hello World'

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=8080)
